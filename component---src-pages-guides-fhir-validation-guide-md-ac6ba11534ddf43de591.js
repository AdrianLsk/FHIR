(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"013z":function(e,t,a){"use strict";a("HQhv"),a("sC2a");var r=a("qKvR"),n=a("pOBw"),i=a("q1tI"),o=a.n(i),s=a("huSw"),l=a("t0dz"),c=a.n(l),p=a("Bfmn"),b=a("a7k6"),d=a("TSYQ"),u=a.n(d),h=a("QH2O"),m=function(e){var t,a=e.children,n=e.title,i=e.tabs,o=void 0===i?[]:i,s=e.shouldHideHeader;return Object(r.b)("div",{className:u()((t={},t[h.pageHeader]=h.pageHeader,t[h.pageHeaderSticky]=o.length,t[h.pageHeaderShifted]=s,t))},Object(r.b)("div",{className:"bx--grid"},Object(r.b)("div",{className:"bx--row"},Object(r.b)("div",{className:"bx--col-lg-12"},Object(r.b)("h1",{id:"page-title",className:h.text},n)))),a)},f=a("Z3H1"),g=a("BAC9"),v=function(e){var t=e.relativePagePath,a=e.repository,n=f.data.site.siteMetadata.repository,i=a||n,o=i.baseUrl,s=o+"/tree/master"+i.subDirectory+"/src/pages"+t;return o?Object(r.b)("div",{className:"bx--row "+g.row},Object(r.b)("div",{className:"bx--col"},Object(r.b)("a",{className:g.link,href:s},"Edit this page on GitHub"))):null},O=a("FCXl"),j=a("Wbzz"),R=a("I8xM");var y=function(e){var t,a;function n(){return e.apply(this,arguments)||this}return a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a,n.prototype.render=function(){var e=this.props,t=e.tabs,a=e.slug,n=a.split("/").filter(Boolean).slice(-1)[0],i=t.map((function(e){var t,i=c()(e,{lower:!0}),o=i===n,s=a.replace(n,i);return Object(r.b)("li",{key:e,className:u()((t={},t[R.selectedItem]=o,t),R.listItem)},Object(r.b)(j.Link,{className:R.link,to:""+s},e))}));return Object(r.b)("div",{className:R.tabsContainer},Object(r.b)("div",{className:"bx--grid"},Object(r.b)("div",{className:"bx--row"},Object(r.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(r.b)("nav",null,Object(r.b)("ul",{className:R.list},i))))))},n}(o.a.Component),I=a("MjG9");t.a=function(e){var t=e.pageContext,a=e.children,i=e.location,o=t.frontmatter,l=void 0===o?{}:o,d=t.relativePagePath,u=l.tabs,h=l.title,f=Object(p.c)(),g=!!u&&"down"===f,j=n.data.site.pathPrefix,R=j?i.pathname.replace(j,""):i.pathname,H=u?R.split("/").slice(-1)[0]||c()(u[0],{lower:!0}):"";return Object(r.b)(b.a,{shouldHideHeader:g,homepage:!1},Object(r.b)(m,{shouldHideHeader:g,title:h,label:"label",tabs:u},u&&Object(r.b)(y,{slug:R,tabs:u,currentTab:H})),Object(r.b)(I.a,{padded:!0},a,Object(r.b)(v,{relativePagePath:d})),Object(r.b)(O.a,{pageContext:t,location:i,slug:R,tabs:u,currentTab:H}),Object(r.b)(s.a,null))}},JEla:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return o})),a.d(t,"default",(function(){return c}));a("E5k/"),a("rzGZ"),a("Dq+y"),a("8npG"),a("Ggvi"),a("qKvR"),a("q1tI");var r=a("E/Ix"),n=a("013z");function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var o={},s={_frontmatter:o},l=n.a;function c(e){var t=e.components,a=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,["components"]);return Object(r.b)(l,i({},s,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"overview"},"Overview"),Object(r.b)("p",null,"The IBM FHIR Server Validation module (",Object(r.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/FHIR/tree/master/fhir-validation"}),"fhir-validation"),") provides Java APIs for validating FHIR resources using constraints specified in their corresponding structure definitions. For example, in the Patient resource, we have the following constraint:"),Object(r.b)("pre",null,Object(r.b)("code",i({parentName:"pre"},{className:"language-java"}),'@Constraint(\n    id = "pat-1",\n    level = "Rule",\n    location = "Patient.contact",\n    description = "SHALL at least contain a contact\'s details or a reference to an organization",\n    expression = "name.exists() or telecom.exists() or address.exists() or organization.exists()"\n)\n')),Object(r.b)("p",null,"The validation component picks up the Java annotation, pulls out the FHIRPath expression and passes it on to the IBM FHIR Server FHIRPath component (",Object(r.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/FHIR/tree/master/fhir-path"}),"fhir-path"),") for evaluation. If the invariant evaluates to ",Object(r.b)("inlineCode",{parentName:"p"},"false")," then the FHIR validator will generate an OperationOutcome.Issue with the severity set relative to the “level” of the constraint (i.e. “Rule” or “Warning”);"),Object(r.b)("img",{src:"https://ibm.github.io/FHIR/images/fhir-dependency-graph.png",alt:"https://ibm.github.io/FHIR/images/fhir-dependency-graph.png"}),Object(r.b)("h2",{id:"profile-support"},"Profile Support"),Object(r.b)("p",null,"The validation component will also validate a resource against profiles that it asserts conformance to in the ",Object(r.b)("inlineCode",{parentName:"p"},"Resource.meta.profile")," element assuming those profiles are available to the IBM FHIR Server via the FHIR registry component (",Object(r.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/FHIR/tree/master/fhir-registry"}),"fhir-registry"),") at runtime."),Object(r.b)("p",null,"Given a FHIR profile (structure definition) as input, the IBM FHIR Server Profile component (",Object(r.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/FHIR/tree/master/fhir-profile"}),"fhir-profile"),") generates FHIRPath expressions for a number of different types of constraints. The current scope of constraint generation is:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Cardinality constraints (required and prohibited elements)"),Object(r.b)("li",{parentName:"ul"},"Fixed value constraints (Code and Uri data types)"),Object(r.b)("li",{parentName:"ul"},"Pattern value constraints (CodeableConcept daa type)"),Object(r.b)("li",{parentName:"ul"},"Reference type constraints (FHIRPath resolve/is/conformsTo functions)"),Object(r.b)("li",{parentName:"ul"},"Extension constraints (FHIRPath ",Object(r.b)("inlineCode",{parentName:"li"},"conformsTo")," function)"),Object(r.b)("li",{parentName:"ul"},"Vocabulary constraints (FHIRPath ",Object(r.b)("inlineCode",{parentName:"li"},"memberOf")," function)"),Object(r.b)("li",{parentName:"ul"},"Choice type constraints (FHIRPath ",Object(r.b)("inlineCode",{parentName:"li"},"as")," function)")),Object(r.b)("p",null,"NOTE: there is currently no support for ",Object(r.b)("inlineCode",{parentName:"p"},"closed")," or ",Object(r.b)("inlineCode",{parentName:"p"},"ordered")," slices."),Object(r.b)("p",null,"For example, the HL7 bodyweight profile has the following cardinality and fixed value constraints (some details removed for brevity):"),Object(r.b)("pre",null,Object(r.b)("code",i({parentName:"pre"},{className:"language-json"}),'{\n    "id": "Observation.code.coding:BodyWeightCode.system",\n    "path": "Observation.code.coding.system",\n    "min": 1,\n    "max": "1",\n    "type": [{\n        "code": "uri"\n    }],\n    "fixedUri": "http://loinc.org"\n}\n')),Object(r.b)("pre",null,Object(r.b)("code",i({parentName:"pre"},{className:"language-json"}),'{\n    "id": "Observation.code.coding:BodyWeightCode.code",\n    "path": "Observation.code.coding.code",\n    "min": 1,\n    "max": "1",\n    "type": [{\n        "code": "code"\n    }],\n    "fixedCode": "29463-7",\n}\n')),Object(r.b)("p",null,"which are used by the ConstraintGenerator to generate the following FHIRPath expression:"),Object(r.b)("pre",null,Object(r.b)("code",i({parentName:"pre"},{}),"code.where(coding.where(system = 'http://loinc.org' and code = '29463-7').exists()).exists()\n")),Object(r.b)("p",null,"The HL7 bodyweight profile has the following reference type constraint (some details removed for brevity):"),Object(r.b)("pre",null,Object(r.b)("code",i({parentName:"pre"},{className:"language-json"}),'{\n    "id": "Observation.subject",\n    "path": "Observation.subject",\n    "type": [{\n        "code": "Reference",\n        "targetProfile": [\n            "http://hl7.org/fhir/StructureDefinition/Patient"\n        ]\n    }]      \n}\n')),Object(r.b)("p",null,"which is used by the ConstraintGenerator to generate the following FHIRPath expression:"),Object(r.b)("pre",null,Object(r.b)("code",i({parentName:"pre"},{}),"subject.resolve().is(Patient)\n")),Object(r.b)("p",null,"Complex reference types are also supported, for example:"),Object(r.b)("pre",null,Object(r.b)("code",i({parentName:"pre"},{}),"derivedFrom.exists() implies (derivedFrom.all(resolve().is(DocumentReference) or resolve().is(ImagingStudy) or resolve().is(Media) or resolve().is(QuestionnaireResponse) or resolve().is(MolecularSequence) or resolve().conformsTo('http://hl7.org/fhir/StructureDefinition/vitalsigns')))\n")),Object(r.b)("p",null,"is generated from the element definition ",Object(r.b)("inlineCode",{parentName:"p"},"Observation.derivedFrom")," in the same bodyweight profile."),Object(r.b)("p",null,"FHIRPath based constraints specified in ",Object(r.b)("inlineCode",{parentName:"p"},"StructureDefinition.snapshot.element.constraint")," elements, will also be evaluated during profile validation. All of the constraints generated for a given profile are cached in memory so that they can be reused to validate multiple resources that are asserting conformance to the same profile."),Object(r.b)("h3",{id:"making-profiles-available-to-the-fhir-registry-component-fhirregistry"},"Making profiles available to the FHIR registry component (FHIRRegistry)"),Object(r.b)("p",null,"The FHIR registry component keeps track of definitional resource types (e.g. StructureDefinition, ValueSet, CodeSystem, etc.). It uses the Java ServiceLoader to look for implementations of the FHIRRegistryResourceProvider interface:"),Object(r.b)("pre",null,Object(r.b)("code",i({parentName:"pre"},{className:"language-java"}),"public interface FHIRRegistryResourceProvider {\n    Collection<FHIRRegistryResource> getResources();\n}\n")),Object(r.b)("p",null,"The FHIRRegistry loads FHIRRegistryResource instances into a map on startup. The FHIRRegistryResource class lazily loads the underlying resource into memory when it is accessed. Multiple versions of the same resource can be registered. FHIR registry resource providers can be bundled into a jar file and deployed with the IBM FHIR server in the user lib directory."),Object(r.b)("h2",{id:"npm-package-format-support"},"NPM package format support"),Object(r.b)("p",null,"The IBM FHIR Server Registry module (",Object(r.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/FHIR/tree/master/fhir-registry"}),"fhir-registry"),") has utilities that can be used to expose FHIR registry resources that exist in the NPM package format. Implementation guides that follow this packaging format can be dropped into the ",Object(r.b)("inlineCode",{parentName:"p"},"src/main/resources/")," under a directory structure defined by the ImplementationGuide.packageId value. For example, US Core implementation guide has a package id of: ",Object(r.b)("inlineCode",{parentName:"p"},"hl7.fhir.us.core"),". The NPM “package” folder can be dropped here:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"src/main/resources/hl7/fhir/us/core/package")),Object(r.b)("img",{src:"https://ibm.github.io/FHIR/images/us-core-package.png",alt:"https://ibm.github.io/FHIR/images/us-core-package.png"}),Object(r.b)("p",null,"The implementation of the ",Object(r.b)("inlineCode",{parentName:"p"},"FHIRRegistryResourceProvider")," SPI looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",i({parentName:"pre"},{className:"language-java"}),'public class USCoreResourceProvider implements FHIRRegistryResourceProvider {\n    @Override\n    public Collection<FHIRRegistryResource> getResources() {\n        return FHIRRegistryUtil.getResources("hl7.fhir.us.core");\n    }\n}\n')),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"FHIRRegistryUtil.getResources(String)")," method takes a packageId (e.g. hl7.fhir.us.core) as input and converts it to a path where it can find the NPM package index file: ",Object(r.b)("inlineCode",{parentName:"p"},".index.json"),"."),Object(r.b)("p",null,"For more information, please see: ",Object(r.b)("a",i({parentName:"p"},{href:"https://confluence.hl7.org/display/FHIR/NPM+Package+Specification"}),"https://confluence.hl7.org/display/FHIR/NPM+Package+Specification")),Object(r.b)("h2",{id:"built-in-profile-support"},"Built-in profile support"),Object(r.b)("p",null,"The IBM FHIR server has built-in support for the following:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Profiles defined in the base FHIR specification STU4 (v4.0.1)"),Object(r.b)("li",{parentName:"ul"},"US Core STU3 (v3.1.0)")),Object(r.b)("h2",{id:"the-ibm-fhir-server-validate-operation"},"The IBM FHIR Server $validate operation"),Object(r.b)("p",null,"The IBM FHIR Server provides a basic implementation of the $validate operation that invokes the FHIRValidator via a REST API. The $validate operation will validate against the base specification and any profiles asserted in ",Object(r.b)("inlineCode",{parentName:"p"},"Resource.meta.profile"),". The optional ",Object(r.b)("inlineCode",{parentName:"p"},"profile")," parameter is not currently supported."),Object(r.b)("h2",{id:"valueset-membership-checking-fhirpath-memberof-function"},"ValueSet membership checking (FHIRPath ",Object(r.b)("inlineCode",{parentName:"h2"},"memberOf")," function)"),Object(r.b)("p",null,"Coded elements (code, Coding, CodeableConcept data types), maybe have a binding element that specifies a ValueSet that that element is bound to. This means that the coded element must have a value that comes from that value set. The FHIR profile component will expand value sets according to the ValueSet ",Object(r.b)("a",i({parentName:"p"},{href:"http://hl7.org/fhir/valueset.html#expansion"}),"expansion algorithm")," for ValueSets that include CodeSystem resources available via the FHIR registry component."))}c.isMDXComponent=!0},Z3H1:function(e){e.exports=JSON.parse('{"data":{"site":{"siteMetadata":{"repository":{"baseUrl":"https://github.com/IBM/FHIR","subDirectory":"/docs"}}}}}')},pOBw:function(e){e.exports=JSON.parse('{"data":{"site":{"pathPrefix":"/FHIR"}}}')}}]);
//# sourceMappingURL=component---src-pages-guides-fhir-validation-guide-md-ac6ba11534ddf43de591.js.map